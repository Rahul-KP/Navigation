
<!DOCTYPE html>
<html>

<head>
	<title>mapquest</title>
	<!-- <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css" /> -->
	<link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css" />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.css" />

	<style>
		body {
			margin: 0;
			padding: 0;
		}

		#map{
			width:100%;
			 height: 100vh;
		}
	</style>

    <link rel="stylesheet" href="style.css">

</head>

<body>
	<div id="map"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.js"></script>
    <script src="https://www.mapquestapi.com/sdk/leaflet/v2.2/mq-map.js?key=BVOw0UMfthNzgXtVPyGhnjUef32v31kc"></script>
    <script src="https://www.mapquestapi.com/sdk/leaflet/v2.2/mq-routing.js?key=BVOw0UMfthNzgXtVPyGhnjUef32v31kc"></script>
	
	<!-- <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"></script> -->
	<script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>

	<script>

		// var map = L.map('map').setView([12.8873909, 77.6412418], 19);
		// mapLink = "<a href='http://openstreetmap.org'>OpenStreetMap</a>";
		// L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', { attribution: 'Leaflet &copy; ' + mapLink + ', contribution', maxZoom: 18 }).addTo(map);
        
        let map = L.map('map', {
        layers: MQ.mapLayer(),
        center: [12.8873909, 77.6412418],
        zoom: 19
        });




            function runDirection(start, end) {
            
            // recreating new map layer after removal
            let map = L.map('map', {
        layers: MQ.mapLayer(),
        center: [12.8873909, 77.6412418],
        zoom: 19
        });
            
            var dir = MQ.routing.directions();

            dir.route({
                locations: [
                    start,
                    end
                ]
            });
        

            CustomRouteLayer = MQ.Routing.RouteLayer.extend({
                createStartMarker: (location) => {
                    var custom_icon;
                    var marker;

                    custom_icon = L.icon({
                        iconUrl: 'start.png',
                        iconSize: [20, 29],
                        iconAnchor: [10, 29],
                        popupAnchor: [0, -29]
                    });

                    marker = L.marker(location.latLng, {icon: custom_icon}).addTo(map);

                    return marker;
                },

                createEndMarker: (location) => {
                    var custom_icon;
                    var marker;

                    custom_icon = L.icon({
                        iconUrl: 'endLoc.png',
                        iconSize: [20, 29],
                        iconAnchor: [10, 29],
                        popupAnchor: [0, -29]
                    });

                    marker = L.marker(location.latLng, {icon: custom_icon}).addTo(map);

                    return marker;
                }
            });
            
            map.addLayer(new CustomRouteLayer({
                directions: dir,
                fitBounds: true
            })); 
        }


    // function that runs when form submitted
    function submitForm(event) {
        event.preventDefault();

        // delete current map layer
        map.remove();

        // getting form data
        start = document.getElementById("start").value;
        end = document.getElementById("destination").value;

        // run directions function
        runDirection(start, end);

        // reset form
        document.getElementById("form").reset();
    }

    // asign the form to form variable
    const form = document.getElementById('form');

    // call the submitForm() function when submitting the form
    form.addEventListener('submit', submitForm);





		var counter =0;
		var StartPoint = L.icon({
			iconUrl: 'start.png',
			iconSize: [60, 60]
		})


		var AmbuIcon = L.icon({
			iconUrl: 'Ambu.png',
			iconSize: [50, 50]
		})

		// here
		var Startloc = L.marker([12.8873909, 77.6412418], { icon: StartPoint, draggable: true }).addTo(map);
		

		var endPoint = L.icon({
			iconUrl: 'endLoc.png',
			iconSize: [70, 70]
		})
		

		map.on('click', function (e) {
			
			console.log(e);
			console.log(e.latlng.lat,+""+e.latlng.lng);
			
			
			var newMarker = L.marker([e.latlng.lat, e.latlng.lng],{ icon: endPoint}).addTo(map);

			
			var Ambi = L.marker([12.8873909, 77.6412418], { icon: AmbuIcon}).addTo(map);

			L.Routing.control({
				waypoints: [
					L.latLng(12.8873909, 77.6412418),
					L.latLng(e.latlng.lat, e.latlng.lng)
				]
			}).on('routesfound', function (e) {
				var routes = e.routes;
				console.log(routes);

				e.routes[0].coordinates.forEach(function (coord, index) {
					setTimeout(function () {
						Ambi.setLatLng([coord.lat, coord.lng]);
					}, 100*index )
				})

			}).addTo(map);

		});


	</script>


</body>

</html>